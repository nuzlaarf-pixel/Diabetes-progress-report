<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ðŸ©º Comprehensive Diabetes History</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <!-- AOS -->
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css"/>
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root{
      --accent: #0d6efd;
      --card-bg: #ffffff;
      --page-bg-1: #e6f7ff;
      --page-bg-2: #f3fff0;
    }
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(135deg,var(--page-bg-1),var(--page-bg-2));
      padding: 20px 0;
    }
    .container-card{
      max-width: 1100px;
      margin:auto;
      background: var(--card-bg);
      border-radius:16px;
      padding:28px;
      box-shadow:0 12px 40px rgba(13,110,253,0.08);
      border:1px solid rgba(13,110,253,0.04);
    }
    .section-title{ display:flex; align-items:center; gap:10px; font-weight:600; color:var(--accent); }
    .card-section{ display:none; }
    .card-section.active{ display:block; }
    .required { color:#d00; margin-left:4px; }
    .progress { height: 10px; border-radius: 999px; overflow: hidden; background: rgba(13,110,253,0.08);}
    .progress > .progress-bar { background: var(--accent); }
    .btn-step{ min-width: 100px; }
    @media (max-width:760px){ .container-card{ padding:18px; margin:8px; } }
  </style>
</head>
<body>
  <div class="container container-card" data-aos="fade-up">
    <h1 class="mb-3"><i class="fa-solid fa-notes-medical"></i> Comprehensive Diabetes History</h1>
    <div class="small-muted mb-2">Progress</div>
    <div class="progress mb-4"><div id="formProgress" class="progress-bar" style="width:0%"></div></div>

    <form id="diabetesForm" class="needs-validation" novalidate>

      <!-- Step 1: Patient Profile -->
      <div class="card-section active" data-aos="zoom-in">
        <div class="section-title"><i class="fa-solid fa-user"></i> Patient Profile</div>
        <div class="row g-3 mt-2">
          <div class="col-md-6"><label>Name <span class="required">*</span></label><input name="name" class="form-control" required></div>
          <div class="col-md-3"><label>DOB <span class="required">*</span></label><input name="dob" id="dob" type="date" class="form-control" onchange="calculateAge()" required></div>
          <div class="col-md-3"><label>Age</label><input name="age" id="age" type="number" class="form-control" readonly></div>
          <div class="col-md-3"><label>Sex <span class="required">*</span></label><select name="sex" class="form-select" required><option value="" disabled selected>Choose...</option><option>Male</option><option>Female</option><option>Other</option></select></div>
          <div class="col-md-6"><label>Occupation</label><input name="occupation" class="form-control"></div>
          <div class="col-md-6"><label>Address</label><input name="address" class="form-control"></div>
          <div class="col-md-6"><label>Ethnicity</label><input name="ethnicity" class="form-control"></div>
          <div class="col-md-6"><label>Education level</label><select name="education" class="form-select"><option value="" disabled selected>Choose...</option><option>Primary</option><option>Secondary</option><option>Graduate</option><option>Post-Graduate</option></select></div>
        </div>
        <div class="mt-3 text-end">
          <button type="button" class="btn btn-primary btn-step" onclick="nextStep()">Next âž¡</button>
        </div>
      </div>

      <!-- Step 2: Presenting Complaint -->
      <div class="card-section" data-aos="zoom-in">
        <div class="section-title"><i class="fa-solid fa-notes-medical"></i> Presenting Complaint</div>
        <label class="form-label mt-2">Symptoms <span class="required">*</span></label>
        <textarea name="symptoms" class="form-control" rows="3" required></textarea>
        <div class="row mt-2 g-2">
          <div class="col-md-4"><label>Duration</label><input name="duration" class="form-control"></div>
          <div class="col-md-4"><label>Onset</label><select name="onset" class="form-select"><option disabled selected>Gradual / Sudden</option><option>Gradual</option><option>Sudden</option></select></div>
          <div class="col-md-4"><label>Course</label><select name="course" class="form-select"><option disabled selected>Progressive / Intermittent</option><option>Progressive</option><option>Intermittent</option></select></div>
        </div>
        <div class="mt-3 d-flex justify-content-between">
          <button type="button" class="btn btn-secondary btn-step" onclick="prevStep()">â¬… Back</button>
          <button type="button" class="btn btn-primary btn-step" onclick="nextStep()">Next âž¡</button>
        </div>
      </div>

      <!-- Step 3: History of Present Illness -->
      <div class="card-section" data-aos="zoom-in">
        <div class="section-title"><i class="fa-solid fa-history"></i> History of Present Illness</div>
        <textarea name="current_symptoms" class="form-control mt-2" rows="2" placeholder="Current symptoms"></textarea>
        <div class="row mt-2 g-3">
          <div class="col-md-6"><input name="hyper_symptoms" class="form-control" placeholder="Hyperglycemic symptoms"></div>
          <div class="col-md-6"><input name="hypo_symptoms" class="form-control" placeholder="Hypoglycemic symptoms"></div>
          <div class="col-md-6 mt-2"><input name="neuropathy" class="form-control" placeholder="Neuropathy / Sensory complaints"></div>
          <div class="col-md-6 mt-2"><input name="vision_skin" class="form-control" placeholder="Vision / Skin issues"></div>
        </div>
        <textarea name="treatment_history" class="form-control mt-2" rows="2" placeholder="Treatment history"></textarea>
        <div class="mt-3 d-flex justify-content-between">
          <button type="button" class="btn btn-secondary btn-step" onclick="prevStep()">â¬… Back</button>
          <button type="button" class="btn btn-primary btn-step" onclick="nextStep()">Next âž¡</button>
        </div>
      </div>

      <!-- Step 4: Past Medical & Surgical History -->
      <div class="card-section" data-aos="zoom-in">
        <div class="section-title"><i class="fa-solid fa-file-medical"></i> Past Medical & Surgical History</div>
        <div class="row g-3 mt-2">
          <div class="col-md-4"><input name="pmh_htn" class="form-control" placeholder="Hypertension"></div>
          <div class="col-md-4"><input name="pmh_dyslip" class="form-control" placeholder="Dyslipidemia"></div>
          <div class="col-md-4"><input name="pmh_cvd" class="form-control" placeholder="Cardiovascular disease"></div>
          <div class="col-md-4"><input name="pmh_kidney" class="form-control" placeholder="Kidney disease"></div>
          <div class="col-md-4"><input name="pmh_eye" class="form-control" placeholder="Eye disease"></div>
          <div class="col-md-4"><input name="pmh_endocrine" class="form-control" placeholder="Other endocrine"></div>
        </div>
        <textarea name="past_surgery" class="form-control mt-2" rows="2" placeholder="Past surgeries"></textarea>
        <div class="mt-3 d-flex justify-content-between">
          <button type="button" class="btn btn-secondary btn-step" onclick="prevStep()">â¬… Back</button>
          <button type="button" class="btn btn-primary btn-step" onclick="nextStep()">Next âž¡</button>
        </div>
      </div>

      <!-- Step 5: Family & Social History -->
      <div class="card-section" data-aos="zoom-in">
        <div class="section-title"><i class="fa-solid fa-users"></i> Family & Social History</div>
        <div class="row g-3 mt-2">
          <div class="col-md-6"><input name="family_diabetes" class="form-control" placeholder="Diabetes in family"></div>
          <div class="col-md-6"><input name="family_cvd" class="form-control" placeholder="CVD in family"></div>
          <div class="col-md-6"><input name="ps_diet" class="form-control" placeholder="Diet"></div>
          <div class="col-md-6"><input name="ps_exercise" class="form-control" placeholder="Exercise"></div>
        </div>
        <div class="mt-3 d-flex justify-content-between">
          <button type="button" class="btn btn-secondary btn-step" onclick="prevStep()">â¬… Back</button>
          <button type="button" class="btn btn-primary btn-step" onclick="nextStep()">Next âž¡</button>
        </div>
      </div>

      <!-- Step 6: Drug, Gyne & Investigations -->
      <div class="card-section" data-aos="zoom-in">
        <div class="section-title"><i class="fa-solid fa-pills"></i> Drug, Gyne & Investigations</div>
        <textarea name="medications" class="form-control mt-2" rows="2" placeholder="Current medications"></textarea>
        <input name="allergies" class="form-control mt-2" placeholder="Allergies">
        <input name="gyn_menses" class="form-control mt-2" placeholder="Menstrual history">
        <input name="gyn_gdm" class="form-control mt-2" placeholder="Gestational diabetes">
        <input name="gyn_preg" class="form-control mt-2" placeholder="Pregnancy/Contraception">
        <div class="row g-3 mt-2">
          <div class="col-md-4"><input name="fbc" class="form-control" placeholder="FBC"></div>
          <div class="col-md-4"><input name="crp" class="form-control" placeholder="CRP"></div>
          <div class="col-md-4"><input name="hba1c" class="form-control" placeholder="HbA1C"></div>
        </div>
        <div class="mt-3 d-flex justify-content-between">
          <button type="button" class="btn btn-secondary btn-step" onclick="prevStep()">â¬… Back</button>
          <button type="submit" class="btn btn-success btn-step">âœ… Submit</button>
        </div>
      </div>

    </form>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
  AOS.init({once:true});
  const steps = document.querySelectorAll(".card-section");
  let currentStep = 0;

  function showStep(n){
    steps.forEach((s,i)=>s.classList.toggle('active',i===n));
    updateProgress();
  }

  function nextStep(){
    const step = steps[currentStep];
    const requiredFields = Array.from(step.querySelectorAll('[required]'));
    const empty = requiredFields.filter(f=>!f.value || f.value.trim()==='');
    if(empty.length > 0){
      Swal.fire({icon:'warning',title:'Incomplete Step',text:'Please fill all required fields (*) in this step.'});
      return;
    }
    if(currentStep < steps.length-1){ currentStep++; showStep(currentStep); }
  }

  function prevStep(){ if(currentStep >0){ currentStep--; showStep(currentStep); } }

  function calculateAge(){
    const dob = document.getElementById('dob').value;
    if(!dob) return;
    const birth = new Date(dob);
    const diff = Date.now()-birth.getTime();
    document.getElementById('age').value = Math.abs(new Date(diff).getUTCFullYear()-1970);
    updateProgress();
  }

  function updateProgress(){
    const required = Array.from(document.querySelectorAll('[required]'));
    const filled = required.filter(el=>el.value && el.value.trim()!=='').length;
    const pct = Math.round((filled/required.length)*100);
    document.getElementById('formProgress').style.width = pct+'%';
  }

  document.querySelectorAll('input,textarea,select').forEach(el=>{
    el.addEventListener('input',updateProgress);
    el.addEventListener('change',updateProgress);
  });

  document.getElementById('diabetesForm').addEventListener('submit', async function(e){
    e.preventDefault();
    const requiredFields = Array.from(document.querySelectorAll('[required]'));
    const emptyFields = requiredFields.filter(el => !el.value || el.value.trim() === '');
    if(emptyFields.length > 0){
      Swal.fire({icon:'warning',title:'Incomplete Form',text:'Please fill all required fields (*) before submitting.'});
      return;
    }

    const btn = this.querySelector('button[type="submit"]');
    btn.disabled = true;
    btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin me-2"></i>Submitting...';
    const formData = new FormData(this);
    try{
      const res = await fetch('submit.php',{method:'POST',body:formData});
      const text = await res.text();
      if(res.ok && text.trim() === 'success'){
        Swal.fire({icon:'success',title:'Saved',text:'History saved successfully.'});
        this.reset();
        document.getElementById('age').value='';
        updateProgress();
        showStep(0);
        currentStep=0;
      }else{
        Swal.fire({icon:'error',title:'Error saving',html:`<pre>${text}</pre>`});
      }
    }catch(err){
      Swal.fire({icon:'error',title:'Network error',text:'Could not submit.'});
    }finally{
      btn.disabled=false;
      btn.innerHTML='âœ… Submit';
    }
  });

  showStep(currentStep);
</script>
</body>
</html>
